const baseModelPrice = 1011.40; // Baseline price with 1TB NVMe included

// SSD prices for both initial and second NVMe
const ssdPrices = {
    "1TB": 56.99,  // Price for adding a second 1TB NVMe
    "2TB": 112.99, // Price for a 2TB NVMe
    "4TB": 229.99  // Price for a 4TB NVMe
};

const additionalRamPrice = 109.99; // Price for extra 16GB RAM

const gpuPrices = {
    "4060": 369.99,
    "4070": 759.99,
    "4080": 1119.99,
    "4090": 2299.99
};

const salesTaxRate = 0.0825;
const fees = {
    "lamination": 10,
    "thermalPaste": 0.50,
    "delivery": 20,
    "labor": 200
};

let calculatedTotal = 0;

function calculateTotal() {
    let total = baseModelPrice; // Start with the baseline price, which includes 1TB NVMe SSD

    const nvmeSize = document.querySelector('input[name="nvme"]:checked')?.value;
    if (nvmeSize === "2TB" || nvmeSize === "4TB") { 
        // Add the difference in cost between the selected NVMe and the baseline 1TB
        total += (ssdPrices[nvmeSize] - ssdPrices["1TB"]);
    }

    if (document.querySelector('input[name="add_second_nvme"]:checked')?.value === "yes") {
        const secondNvmeSize = document.querySelector('input[name="second_nvme"]:checked').value;
        total += ssdPrices[secondNvmeSize]; // Add cost for the second NVMe SSD
    }

    if (document.querySelector('input[name="add_ram"]:checked')?.value === "yes") {
        total += additionalRamPrice;
    }

    if (document.querySelector('input[name="add_gpu"]:checked')?.value === "yes") {
        const gpu = document.querySelector('input[name="gpu"]:checked').value;
        total += gpuPrices[gpu];
    }

    const totalBeforeTax = total; // This should be the subtotal before tax and fees
    total += totalBeforeTax * salesTaxRate; // Apply tax
    total += fees.lamination + fees.thermalPaste + fees.delivery + fees.labor; // Add fees

    calculatedTotal = total;

    document.getElementById('total').innerText = "Total: $" + total.toFixed(2) + " - Total Including Delivery and Tax";
}

function showNext(id, condition) {
    const element = document.getElementById(id);
    if (condition) {
        element.classList.remove('hidden');
    } else {
        element.classList.add('hidden');
    }
    calculateTotal();
}

function initialize() {
    document.querySelectorAll('input[type="radio"]').forEach(radio => {
        radio.addEventListener('change', () => calculateTotal());
    });

    const ramRadios = document.querySelectorAll('input[name="add_ram"]');
    ramRadios.forEach(radio => {
        radio.addEventListener('change', () => {
            document.getElementById('total').style.display = "block";
            document.getElementById('paypal-button-container').style.display = "block";
        });
    });
}

window.onload = function () {
    initialize();

    paypal.Buttons({
        createOrder: function(data, actions) {
            return actions.order.create({
                purchase_units: [{
                    amount: {
                        value: calculatedTotal.toFixed(2) // Use the calculated total
                    }
                }]
            });
        },
        onApprove: function(data, actions) {
            return actions.order.capture().then(function(details) {
                alert('Transaction completed by ' + details.payer.name.given_name);
            });
        }
    }).render('#paypal-button-container');
};
